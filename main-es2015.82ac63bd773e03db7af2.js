(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{0:function(t,e,n){t.exports=n("2v48")},"2mhZ":function(t,e,n){"use strict";n.d(e,"a",(function(){return S})),n.d(e,"b",(function(){return I})),n.d(e,"c",(function(){return M})),n.d(e,"d",(function(){return E})),n.d(e,"e",(function(){return m})),n.d(e,"f",(function(){return y})),n.d(e,"g",(function(){return T})),n.d(e,"h",(function(){return D})),n.d(e,"i",(function(){return j})),n.d(e,"j",(function(){return k})),n.d(e,"k",(function(){return N})),n.d(e,"l",(function(){return g})),n.d(e,"m",(function(){return R})),n.d(e,"n",(function(){return z})),n.d(e,"o",(function(){return B})),n.d(e,"p",(function(){return X})),n.d(e,"q",(function(){return x})),n.d(e,"r",(function(){return C})),n.d(e,"s",(function(){return O})),n.d(e,"t",(function(){return G})),n.d(e,"u",(function(){return p})),n.d(e,"v",(function(){return f})),n.d(e,"w",(function(){return b})),n.d(e,"x",(function(){return L})),n.d(e,"y",(function(){return A})),n.d(e,"z",(function(){return U}));var r=n("CIZ5"),o=n("fXoL"),i=n("AcyG"),a=n("z5Zb"),s=n("2Vo4"),c=n("cp0P"),u=n("7+OI"),l=n("lJxs"),d=n("UXun");function p(t){return"undefined"!==t&&null!=t}function f(t){return!p(t)}function g(t){return JSON.parse(JSON.stringify(void 0===t?{}:t))}function b(t){return"object"==typeof t&&!Array.isArray(t)&&null!==t}function h(t){return t.NGXS_OPTIONS_META||{name:""}}class v extends Error{constructor(t){super(`Child states can only be added to an object. Cannot convert ${t&&t.constructor?t.constructor.name:t} to PlainObject`)}}function y(t){const e=h(t),n=e.children||[],r=g(e.defaults);if(n.length){if(b(r))return function(t,e){return e.reduce((t,e)=>{const n=h(e);if(!n.name)throw new Error("State name not provided in class");return t[n.name.toString()]=y(e),t},t)}(r,n);throw new v(r)}return r}function m(t){const{statePath:e,argumentsNames:n,methodName:r,argumentRegistry:o}=t;let i="";for(let a=0;a<n.length;a++)(null==o?void 0:o.getArgumentNameByIndex(a))?i+=null==o?void 0:o.getArgumentNameByIndex(a):(null==o?void 0:o.getPayloadTypeByIndex(a))?i+=null==o?void 0:o.getPayloadTypeByIndex(a):i+="$arg"+a,a!==n.length-1&&(i+=", ");return`@${e.replace(/\./g,"/")}.${r}(${i})`}function S(t){return(t+"").replace(/[/][/].*$/gm,"").replace(/\s+/g,"").replace(/[/][*][^/*]*[*][/]/g,"").split("){",1)[0].replace(/^[^(]*[(]/,"").replace(/=[^,]+/g,"").split(",").filter(Boolean)}function x(t){if(!t.hasOwnProperty(r.e)){const e={name:null,actions:{},defaults:{},path:null,makeRootSelector:t=>t.getStateGetter(e.name),children:[]};Object.defineProperty(t,r.e,{value:e})}return function(t){return t[r.e]}(t)}function O(t){return t[r.c]}const w=t=>{const e=t instanceof Date;if("object"!=typeof t||null===t||e)return t;Object.freeze(t);const n="function"==typeof t,r=Object.prototype.hasOwnProperty;return Object.getOwnPropertyNames(t).forEach(e=>{!r.call(t,e)||n&&("caller"===e||"callee"===e||"arguments"===e)||null===t[e]||"object"!=typeof t[e]&&"function"!=typeof t[e]||Object.isFrozen(t[e])||w(t[e])}),t};let E=(()=>{class t{constructor(t){this.sequence$=new s.a(0),this.subscription=null,t&&(this.subscription=t.subscribe(()=>this.updateSequence()))}get sequenceValue(){return this.sequence$.getValue()}ngOnDestroy(){var t;this.sequence$.next(0),null===(t=this.subscription)||void 0===t||t.unsubscribe()}updateSequence(){this.sequence$.next(this.sequenceValue+1)}}return t.\u0275fac=function(e){return new(e||t)(o.Zb(i.g,8))},t.\u0275prov=o.Lb({token:t,factory:t.\u0275fac}),t})(),M=(()=>{class t{constructor(e,n,r){t.store=e.get(i.g),t.ngZone=e.get(o.B),t.factory=n,t.context=r,t.computed=e.get(E)}}return t.\u0275fac=function(e){return new(e||t)(o.Zb(o.t),o.Zb(a.d),o.Zb(a.c))},t.\u0275prov=o.Lb({token:t,factory:t.\u0275fac}),t.store=null,t.computed=null,t.context=null,t.factory=null,t.ngZone=null,t})(),I=(()=>{class t{constructor(){t.statesCachedMeta.clear()}static createStateContext(t){return M.context.createStateContext(t)}static ensureMappedState(e){if(!M.factory||!e)throw new Error("Metadata not created \n Maybe you forgot to import the NgxsDataPluginModule\n Also, you cannot use this.ctx.* until the application is fully rendered \n (use by default ngxsOnInit(ctx: StateContext), or ngxsAfterBootstrap(ctx: StateContext) !!!");return(e.name?t.statesCachedMeta.get(e.name):null)||t.ensureMeta(e)}static getRepositoryByInstance(e){const n=O(t.getStateClassByInstance(e))||null;if(!n)throw new Error("You forgot add decorator @StateRepository or initialize state!\nExample: NgxsModule.forRoot([ .. ]), or NgxsModule.forFeature([ .. ])");return n}static getStateClassByInstance(t){return(t||{}).constructor}static clearMetaByInstance(e){const n=t.getRepositoryByInstance(e);n.stateMeta.actions={},n.operations={}}static createPayload(t,e){const n={},r=Array.from(t);for(let o=0;o<r.length;o++)(null==e?void 0:e.getPayloadTypeByIndex(o))&&(n[null==e?void 0:e.getPayloadTypeByIndex(o)]=r[o]);return Object.keys(n).length>0?n:null}static createAction(e,n,r){const o=t.createPayload(n,r);var i;return new(i=e.type,class{constructor(t){t&&Object.keys(t).forEach(e=>{this[e]=t[e]})}static get type(){return i}})(o)}static ensureMeta(e){var n;const r=e.name?null===(n=M.factory.states)||void 0===n?void 0:n.find(t=>t.name===e.name):null;return r&&e.name&&t.statesCachedMeta.set(e.name,r),r}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=o.Lb({token:t,factory:t.\u0275fac}),t.statesCachedMeta=new Map,t})();function j(t){return{enumerable:!0,configurable:!0,get(){const e=O(t),n=I.ensureMappedState(e.stateMeta);return I.createStateContext(n)}}}function k(t,e){(function(t){var e;const n=null!==(e=O(t))&&void 0!==e?e:null;return(!n||(null==n?void 0:n.stateClass)!==t)&&function(t){Object.defineProperty(t,r.c,{writable:!0,configurable:!0,enumerable:!0,value:{stateMeta:null,operations:{},stateClass:t}})}(t),O(t)}(t)).stateMeta=e}function N(t){const e=O(t),n=e.stateMeta&&e.stateMeta.name||null;if(n){const e=`__${n}__selector`;Object.defineProperties(t.prototype,{[e]:{writable:!0,enumerable:!1,configurable:!0},state$:{enumerable:!0,configurable:!0,get(){if(this[e])return this[e];if(!M.store)throw new Error("Metadata not created \n Maybe you forgot to import the NgxsDataPluginModule\n Also, you cannot use this.ctx.* until the application is fully rendered \n (use by default ngxsOnInit(ctx: StateContext), or ngxsAfterBootstrap(ctx: StateContext) !!!");return this[e]=M.store.select(t).pipe(Object(l.a)(t=>Object(o.Y)()?w(t):t),Object(d.a)({refCount:!0,bufferSize:1})),this[e]}}})}}function A(t,e){if(t.hasOwnProperty("prototype"))throw new Error("Cannot support static methods with @DataAction()");if(void 0===e)throw new Error("@DataAction() can only decorate a method implementation")}function T(){if(!M.ngZone)throw new Error("Metadata not created \n Maybe you forgot to import the NgxsDataPluginModule\n Also, you cannot use this.ctx.* until the application is fully rendered \n (use by default ngxsOnInit(ctx: StateContext), or ngxsAfterBootstrap(ctx: StateContext) !!!")}function D(t,e){return Object(c.a)([t,e]).pipe(Object(l.a)(t=>t.pop()))}class _ extends Error{constructor(t,e){super(`An argument with the name '${t}' already exists in the method '${e}'`)}}class P{constructor(){this.payloadMap=new Map,this.argumentMap=new Map}getPayloadTypeByIndex(t){var e;return null!==(e=this.payloadMap.get(t))&&void 0!==e?e:null}getArgumentNameByIndex(t){var e;return null!==(e=this.argumentMap.get(t))&&void 0!==e?e:null}createPayloadType(t,e,n){this.checkDuplicateName(t,e),this.payloadMap.set(n,t),this.payloadMap.set(t,t)}createArgumentName(t,e,n){this.checkDuplicateName(t,e),this.argumentMap.set(n,t),this.argumentMap.set(t,t)}checkDuplicateName(t,e){if(this.argumentMap.has(t)||this.payloadMap.has(t))throw new _(t,e)}}function C(t){return t[r.a]}function B(t,e){const n=t[e];return C(n)||Object.defineProperties(n,{[r.a]:{enumerable:!0,configurable:!0,value:new P}}),C(n)}function U(t,e){var n;if(!(null===(n=Object.getOwnPropertyDescriptor(t,e))||void 0===n?void 0:n.get))throw new Error(`The method must be a getter for the computed decorator to work properly.\nExample: \n@Computed() get ${e.toString()}() { \n\t .. \n}`)}function z(t){if(!t)throw new Error("You forgot add decorator @StateRepository or initialize state!\nExample: NgxsModule.forRoot([ .. ]), or NgxsModule.forFeature([ .. ])");return Object.assign(Object.assign({},t),{getState:()=>Object(o.Y)()?w(t.getState()):t.getState(),setState(e){t.setState(e)},patchState(e){t.patchState(e)}})}function V(){return`__${r.b}__`}function $(t){var e;return null!==(e=t[V()])&&void 0!==e?e:null}function R(t){return $(t)||Object.defineProperties(t,{[V()]:{enumerable:!0,configurable:!0,value:new WeakMap}}),$(t)}function X(t){return Object(o.Y)()?w(t):t}function G(){var t,e;return null!==(e=null===(t=null==M?void 0:M.computed)||void 0===t?void 0:t.sequenceValue)&&void 0!==e?e:0}function L(t){let e=!1;return Object(u.a)(t)&&(e=!0),e}},"2v48":function(t,e,n){"use strict";n.r(e);var r=n("fXoL"),o=n("3Pt+"),i=n("jhN1"),a=n("R1ws"),s=n("2mhZ");let c=(()=>{class t{constructor(t,e){this.accessor=t,this.injector=e}static forRoot(e=[]){return{ngModule:t,providers:[s.b,s.c,s.d,...e]}}}return t.\u0275mod=r.Nb({type:t}),t.\u0275inj=r.Mb({factory:function(e){return new(e||t)(r.Zb(s.b,2),r.Zb(s.c,2))}}),t})();var u=n("BbUs"),l=n("XpPX"),d=n("/wON"),p=n("AcyG"),f=n("tyNb");let g=(()=>{class t{}return t.\u0275mod=r.Nb({type:t}),t.\u0275inj=r.Mb({factory:function(e){return new(e||t)},imports:[[f.b.forRoot([{path:"",redirectTo:"count",pathMatch:"full"},{path:"count",loadChildren:()=>Promise.all([n.e(0),n.e(11)]).then(n.bind(null,"iBbY")).then(t=>t.CountModule)},{path:"todo",loadChildren:()=>Promise.all([n.e(0),n.e(2),n.e(13)]).then(n.bind(null,"BX/J")).then(t=>t.TodoModule)},{path:"person",loadChildren:()=>Promise.all([n.e(0),n.e(3),n.e(12)]).then(n.bind(null,"rAEy")).then(t=>t.PersonModule)},{path:"amount",loadChildren:()=>Promise.all([n.e(0),n.e(9)]).then(n.bind(null,"h86J")).then(t=>t.AmountModule)},{path:"article",loadChildren:()=>Promise.all([n.e(0),n.e(2),n.e(3),n.e(10)]).then(n.bind(null,"BVaH")).then(t=>t.ArticleModule)}],{useHash:!0})],f.b]}),t})();var b=n("ofXK");const h=function(){return["count"]},v=function(){return["todo"]},y=function(){return["person"]},m=function(){return["amount"]},S=function(){return["article"]};let x=(()=>{class t{constructor(t){this.store=t,this.snapshot=this.store.select(t=>t)}ngOnInit(){console.log("[isDevMode]",Object(r.Y)())}}return t.\u0275fac=function(e){return new(e||t)(r.Pb(p.g))},t.\u0275cmp=r.Jb({type:t,selectors:[["app-root"]],decls:72,vars:15,consts:[[1,"panel"],["src","https://habrastorage.org/webt/k7/ih/pc/k7ihpcg6w-jz-rzksmiyuip5_so.png",1,"logo"],[1,"panel-content"],[1,"menu"],[1,"menu-top"],["href","https://github.com/ngxs-labs/data/tree/master/docs","target","_blank",1,"link"],["href","https://stackblitz.io/github/ngxs-labs/data","target","_blank",1,"link"],[1,"ng-icon"],["src","https://cdn.worldvectorlogo.com/logos/angular-icon-1.svg",1,"img"],[1,"link",3,"routerLink"],[1,"container"],[1,"content"]],template:function(t,e){1&t&&(r.Vb(0,"div",0),r.vc(1,"\n    "),r.Qb(2,"img",1),r.vc(3,"\n\n    "),r.Vb(4,"div",2),r.vc(5,"\n        "),r.Vb(6,"h2"),r.vc(7,"Store:"),r.Ub(),r.vc(8,"\n        "),r.Vb(9,"pre"),r.vc(10),r.gc(11,"json"),r.gc(12,"async"),r.Ub(),r.vc(13,"\n    "),r.Ub(),r.vc(14,"\n"),r.Ub(),r.vc(15,"\n\n"),r.Vb(16,"div",3),r.vc(17,"\n    "),r.Vb(18,"div",4),r.vc(19,"\n        "),r.Vb(20,"span"),r.vc(21,"\n            \u{1f9fe}\n            "),r.Vb(22,"a",5),r.vc(23,"\n                Official documentation\n            "),r.Ub(),r.vc(24,"\n        "),r.Ub(),r.vc(25,"\n        "),r.Vb(26,"span"),r.vc(27,"\n            \u{1f680} "),r.Vb(28,"a",6),r.vc(29,"Stackblitz"),r.Ub(),r.vc(30,"\n        "),r.Ub(),r.vc(31,"\n        "),r.Vb(32,"span",7),r.vc(33,"\n            "),r.Qb(34,"img",8),r.vc(35,"\n            Angular 8+, NGXS 3.6.2+\n        "),r.Ub(),r.vc(36,"\n    "),r.Ub(),r.vc(37,"\n\n    "),r.Vb(38,"span"),r.vc(39,"\u{1f3c0} "),r.Vb(40,"a",9),r.vc(41,"CountState"),r.Ub(),r.Ub(),r.vc(42,"\n    "),r.Vb(43,"span"),r.vc(44,"\u{1f9ed} "),r.Vb(45,"a",9),r.vc(46,"TodoState"),r.Ub(),r.Ub(),r.vc(47,"\n    "),r.Vb(48,"span"),r.vc(49,"\u{1f60b} "),r.Vb(50,"a",9),r.vc(51,"PersonState"),r.Ub(),r.Ub(),r.vc(52,"\n    "),r.Vb(53,"span"),r.vc(54,"\u{1f4b0} "),r.Vb(55,"a",9),r.vc(56,"AmountState"),r.Ub(),r.Ub(),r.vc(57,"\n    "),r.Vb(58,"span"),r.vc(59,"\u{1f4cb} "),r.Vb(60,"a",9),r.vc(61,"ArticleEntitiesState"),r.Ub(),r.Ub(),r.vc(62,"\n"),r.Ub(),r.vc(63,"\n\n"),r.Qb(64,"br"),r.vc(65,"\n\n"),r.Vb(66,"div",10),r.vc(67,"\n    "),r.Vb(68,"div",11),r.Qb(69,"router-outlet"),r.Ub(),r.vc(70,"\n"),r.Ub(),r.vc(71,"\n")),2&t&&(r.Eb(10),r.wc(r.hc(11,6,r.hc(12,8,e.snapshot))),r.Eb(30),r.kc("routerLink",r.lc(10,h)),r.Eb(5),r.kc("routerLink",r.lc(11,v)),r.Eb(5),r.kc("routerLink",r.lc(12,y)),r.Eb(5),r.kc("routerLink",r.lc(13,m)),r.Eb(5),r.kc("routerLink",r.lc(14,S)))},directives:[f.a,f.c],pipes:[b.f,b.b],encapsulation:2,changeDetection:0}),t})(),O=(()=>{class t{}return t.\u0275mod=r.Nb({type:t,bootstrap:[x]}),t.\u0275inj=r.Mb({factory:function(e){return new(e||t)},providers:[],imports:[[i.a,o.e,g,a.b,o.k,p.c.forRoot([],{developmentMode:!1,executionStrategy:p.d}),d.a.forRoot(),c.forRoot([u.b,u.a]),l.a]]}),t})();Object(r.U)(),i.d().bootstrapModule(O).catch(t=>console.error(t))},"BS/u":function(t,e){function n(t){return Promise.resolve().then((function(){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}))}n.keys=function(){return[]},n.resolve=n,t.exports=n,n.id="BS/u"},BbUs:function(t,e,n){"use strict";n.d(e,"a",(function(){return f})),n.d(e,"b",(function(){return T})),n.d(e,"c",(function(){return P})),n.d(e,"d",(function(){return _}));var r=n("fXoL"),o=n("AcyG"),i=n("ofXK"),a=n("2mhZ"),s=n("CIZ5"),c=n("l5mm"),u=n("xgIS"),l=n("vkgz");const d=new r.s("NGXS_DATA_STORAGE_CONTAINER_TOKEN");class p{constructor(){this.providers=new Set,this.keys=new Map}getProvidedKeys(){return Array.from(this.keys.keys())}}const f={provide:d,useFactory:function(){return new p}},g=new r.s("NGXS_DATA_STORAGE_DECODE_TYPE_TOKEN");function b(t){return-1!==t.ttl&&!isNaN(t.ttl)&&t.ttl>0}function h(t){return Date.now()>=t.getTime()}function v(t){return`${t.prefixKey}${t.path}`}function y(t,e){var n,r,o;const{provider:i,expiry:s}=e,c={key:t,expiry:s.toISOString(),timestamp:new Date(Date.now()).toISOString()},u=i.stateInstance;null===(n=null==u?void 0:u.expired$)||void 0===n||n.next(c),(null==u?void 0:u.ngxsDataAfterExpired)&&(a.c.ngZone?null===(r=a.c.ngZone)||void 0===r||r.run(()=>{var t;return null===(t=null==u?void 0:u.ngxsDataAfterExpired)||void 0===t?void 0:t.call(u,c,i)}):null===(o=null==u?void 0:u.ngxsDataAfterExpired)||void 0===o||o.call(u,c,i))}class m extends Error{constructor(t){super(`${t}. \nIncorrect structure for deserialization!!! Your structure should be like this: \n${JSON.stringify({lastChanged:"2020-01-01T12:00:00.000Z",data:"{}",version:1},null,4)}`)}}function S(t){try{return JSON.parse(t)}catch(e){throw new m(e.message)}}function x(t){var e,n;const{provider:r,map:o}=t;null===(e=o.get(r))||void 0===e||e.subscription.unsubscribe();const i=()=>{const e=new Date(Date.now()).toISOString(),n=Object(c.a)(r.ttlDelay).subscribe(()=>function(t,e,n){const{provider:r,expiry:o,map:i,engine:a}=e,s=v(r),c=a.getItem(s);if(c){if(h(o)){const o=new Date(Date.now()).toISOString();!function(t,e,n){const{provider:r,engine:o}=n;switch(r.ttlExpiredStrategy){case 0:o.removeItem(t);break;case 1:const n=S(e);n.data=null,o.setItem(t,JSON.stringify(n))}}(s,c,e),y(s,e),n.unsubscribe(),i.set(r,{subscription:n,startListen:t,endListen:o})}}else n.unsubscribe()}(e,t,n));o.set(r,{subscription:n,startListen:e,endListen:null})};a.c.ngZone?null===(n=a.c.ngZone)||void 0===n||n.runOutsideAngular(()=>i()):i()}class O extends Error{constructor(){super("missing key 'data' or it's value not serializable.")}}class w extends Error{constructor(t){super(`lastChanged key not found in object ${t}.`)}}class E extends Error{constructor(t){super(`It's not possible to determine version (${t}), since it must be a integer type and must equal or more than 1.`)}}function M(t,e){const n=Object(a.u)(t)?t:null;return"base64"===e.decode?btoa(JSON.stringify(n)):n}class I extends Error{constructor(t){super(`Not found storage engine from \`existingEngine\` or not found instance after injecting by \`useClass\`. \nMetadata { key: '${t}' }`)}}class j extends Error{constructor(){super("StorageEngine instance should be implemented by DataStorageEngine interface")}}function k(t,e){const n=t.existingEngine||e.get(t.useClass,null);if(!n)throw new I(v(t));if(!("getItem"in n))throw new j;return n}function N(t,e){console.warn(`Error occurred while serializing value from metadata { key: '${t}' }. \nError serialize: ${e}`)}let A=(()=>{class t{constructor(e,n){this._platformId=e,t.injector=n,this.listenWindowEvents()}get store(){return t.injector.get(o.g,null)}get size(){return this.providers.size}get ttlListeners(){return t.ttlListeners}get container(){return t.injector.get(d)}get providers(){return this.container.providers}get keys(){return this.container.keys}get entries(){return this.providers.entries()}get skipStorageInterceptions(){return 0===this.size||Object(i.r)(this._platformId)}static checkIsStorageEvent(t,e,n){var r;const{action:o,provider:i,key:a,value:c}=t;if(e.rehydrateIn&&function(t){return t.type===s.d}(o)){const t=i.stateInstance;(null==t?void 0:t.ngxsDataAfterStorageEvent)&&(null===(r=null==t?void 0:t.ngxsDataAfterStorageEvent)||void 0===r||r.call(t,{key:a,value:c,data:n,provider:i}))}}static checkExpiredInit(t){const{info:e,rehydrateInfo:n,options:r,map:o}=t,{provider:i,engine:a}=r;n.rehydrateIn&&e.expiry&&x({provider:i,expiry:e.expiry,map:o,engine:a})}handle(t,e,n){if(this.skipStorageInterceptions)return n(t,e);const r=function(t){const e=Object(o.i)(t);return e(o.a)||e(o.h)}(e);return n(t=this.pullStateFromStorage(t,{action:e,init:r}),e).pipe(Object(l.a)(n=>this.pushStateToStorage(t,n,{action:e,init:r})))}serialize(e,n){const r={version:n.version,lastChanged:(new Date).toISOString(),data:M(e,n)};if(b(n)){const e=k(n,t.injector),o=new Date(Date.now()+parseInt(n.ttl));x({provider:n,expiry:o,map:this.ttlListeners,engine:e}),r.expiry=o.toISOString()}return JSON.stringify(r)}deserialize(t,e,n){return function(t,e,n){if(Object(a.w)(t)){if(function(t){return!("lastChanged"in t)||!t.lastChanged}(t))throw new w(e);if(function(t){const e=parseFloat(t.version);return isNaN(e)||e<1||parseInt(t.version)!==e}(t))throw new E(t.version);if(function(t){return!("data"in t)}(t))throw new O;return"base64"===n.decode?JSON.parse(atob(t.data)):t.data}throw new m(`"${e}" not an object`)}(t,e,n)}destroyOldTasks(){var e;null===(e=t.eventsSubscriptions)||void 0===e||e.unsubscribe(),t.ttlListeners=new WeakMap}pushStateToStorage(e,n,r){for(const[a]of this.entries){const s=Object(o.k)(e,a.path),c=Object(o.k)(n,a.path),u=a.fireInit&&r.init;if(s!==c||u){const e=k(a,t.injector),n=v(a);try{const t=this.serialize(c,a);e.setItem(n,t),this.keys.set(n)}catch(i){N(n,i.message)}}}}pullStateFromStorage(t,{action:e,init:n}){if(this.canBeSyncStoreWithStorage(e,n))for(const[r]of this.entries)t=this.deserializeByProvider(t,e,r);return t}canBeSyncStoreWithStorage(t,e){return this.size>0&&(e||t.type===s.d)}deserializeByProvider(e,n,r){const o=v(r),i=k(r,t.injector),s=i.getItem(o);return Object(a.u)(s)&&(e=this.deserializeHandler(e,{key:o,engine:i,provider:r,value:s,action:n})),e}deserializeHandler(e,n){const{key:r,provider:i,value:s}=n;try{const c=S(s),u=this.deserialize(c,s,i),l=function(t){const{data:e,provider:n}=t,r=Object(a.u)(e)||n.nullable;let o={canBeOverrideFromStorage:r,versionMismatch:!1,expired:!1,expiry:null};return o=function(t,e,n){const{meta:r,provider:o}=n;if(t&&b(o)){const n=new Date(r.expiry);!isNaN(n.getTime())&&(e=h(n)?{canBeOverrideFromStorage:!1,expired:!0,expiry:n,versionMismatch:!1}:{canBeOverrideFromStorage:t,expired:!1,expiry:n,versionMismatch:!1})}return e}(r,o,t),o=function(t,e,n){const{meta:r,provider:o}=n;if(t&&r.version!==o.version){const t=o.stateInstance,n=!(o.skipMigrate||!(null==t?void 0:t.ngxsDataStorageMigrate)&&!o.migrate);e=Object.assign(Object.assign({},e),n?{versionMismatch:!0}:{canBeOverrideFromStorage:!1,versionMismatch:!0})}return e}(r,o,t),o}({provider:i,meta:c,data:u});if(l.canBeOverrideFromStorage){const a=function(t){var e;let n=t.states;const{provider:r,data:i,info:a}=t;if(!r.rehydrate)return{states:n,rehydrateIn:!1};const s=Object(o.k)(n,r.path);if(a.versionMismatch){const t=r.stateInstance,a=r.migrate||(null===(e=t.ngxsDataStorageMigrate)||void 0===e?void 0:e.bind(r.stateInstance)),c=null==a?void 0:a(s,i);return n=Object(o.l)(n,r.path,c),{states:n,rehydrateIn:!0}}return JSON.stringify(s)!==JSON.stringify(i)?(n=Object(o.l)(n,r.path,i),{states:n,rehydrateIn:!0}):{states:n,rehydrateIn:!1}}({states:e,provider:i,data:u,info:l});this.keys.set(r),e=a.states,t.checkIsStorageEvent(n,a,u),t.checkExpiredInit({info:l,rehydrateInfo:a,options:n,map:this.ttlListeners})}else this.removeKeyWhenPullInvalid(l,n)}catch(c){!function(t,e,n){console.warn(`Error occurred while deserializing value from metadata { key: '${t}', value: '${e}' }. \nError deserialize: ${n}`)}(r,s,c.message)}return e}removeKeyWhenPullInvalid(t,e){const{key:n,engine:r,provider:o}=e;t.expired&&y(n,{provider:o,engine:r,map:this.ttlListeners,expiry:t.expiry}),r.removeItem(n),this.keys.delete(n)}listenWindowEvents(){Object(i.r)(this._platformId)||(this.destroyOldTasks(),t.eventsSubscriptions=Object(u.a)(window,"storage").subscribe(t=>{t.key&&this.keys.has(t.key)&&this.store.dispatch({type:s.d})}))}}return t.\u0275fac=function(e){return new(e||t)(r.Zb(r.D),r.Zb(r.t,2))},t.\u0275prov=r.Lb({token:t,factory:t.\u0275fac}),t.injector=null,t.eventsSubscriptions=null,t.ttlListeners=new WeakMap,t})();const T={provide:o.b,useClass:A,multi:!0},D=new r.s("NGXS_DATA_STORAGE_PREFIX_TOKEN");function _(t){var e;try{const n=null===(e=A.injector)||void 0===e?void 0:e.get(d);t.forEach(t=>{n.providers.add(t)})}catch(n){throw new Error("You forgot provide NGXS_DATA_STORAGE_CONTAINER or NGXS_DATA_STORAGE_EXTENSION!!! Example: \n\n@NgModule({\n imports: [ \n   NgxsDataPluginModule.forRoot([NGXS_DATA_STORAGE_PLUGIN]) \n ]\n})\nexport class AppModule {} \n\n")}}function P(t,e,n){var r,o;let i;const s=null===(r=A.injector)||void 0===r?void 0:r.get(D,"@ngxs.store."),c=null===(o=A.injector)||void 0===o?void 0:o.get(g,"none");return i=n?(Array.isArray(n)?n:[n]).map(n=>function({option:t,decodeType:e,prefix:n,meta:r,stateInstance:o}){return function(t,e){return"path"in e||(e=Object.assign(Object.assign({},e),{get path(){return t.stateMeta&&t.stateMeta.path}})),e}(r,Object.assign(Object.assign({},t),{ttl:Object(a.u)(t.ttl)?t.ttl:-1,version:Object(a.u)(t.version)?t.version:1,decode:Object(a.u)(t.decode)?t.decode:e,prefixKey:Object(a.u)(t.prefixKey)?t.prefixKey:n,nullable:!!Object(a.u)(t.nullable)&&t.nullable,fireInit:!Object(a.u)(t.fireInit)||t.fireInit,rehydrate:!Object(a.u)(t.rehydrate)||t.rehydrate,ttlDelay:Object(a.u)(t.ttlDelay)?t.ttlDelay:6e4,ttlExpiredStrategy:Object(a.u)(t.ttlExpiredStrategy)?t.ttlExpiredStrategy:0,stateInstance:Object(a.u)(t.stateInstance)?t.stateInstance:o,skipMigrate:!!Object(a.u)(t.skipMigrate)&&t.skipMigrate}))}({option:n,prefix:s,decodeType:c,meta:t,stateInstance:e})):function(t){const{meta:e,decodeType:n,prefix:r,stateInstance:o}=t;return[{get path(){return e.stateMeta&&e.stateMeta.path},existingEngine:localStorage,ttl:-1,version:1,decode:n,prefixKey:r,nullable:!1,fireInit:!0,rehydrate:!0,ttlDelay:6e4,ttlExpiredStrategy:0,stateInstance:o,skipMigrate:!1}]}({meta:t,prefix:s,decodeType:c,stateInstance:e}),i}},CIZ5:function(t,e,n){"use strict";n.d(e,"a",(function(){return a})),n.d(e,"b",(function(){return s})),n.d(e,"c",(function(){return o})),n.d(e,"d",(function(){return r})),n.d(e,"e",(function(){return i}));const r="NGXS_DATA_STORAGE_EVENT_TYPE",o="NGXS_DATA_META",i="NGXS_META",a="NGXS_ARGUMENT_REGISTRY_META",s="NGXS_COMPUTED_OPTION"},XpPX:function(t,e,n){"use strict";n.d(e,"a",(function(){return c})),n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return a})),n.d(e,"d",(function(){return s}));var r=n("ofXK"),o=n("fXoL");function i(t){return null!=t?t:{ids:[],entities:{}}}function a(t,e,n){return(null==e?void 0:e[t])>(null==n?void 0:n[t])?1:(null==e?void 0:e[t])<(null==n?void 0:n[t])?-1:0}function s(t,e,n){return(null==e?void 0:e[t])>(null==n?void 0:n[t])?-1:(null==e?void 0:e[t])<(null==n?void 0:n[t])?1:0}let c=(()=>{class t{}return t.\u0275mod=o.Nb({type:t}),t.\u0275inj=o.Mb({factory:function(e){return new(e||t)},imports:[[r.c]]}),t})()}},[[0,1,8]]]);