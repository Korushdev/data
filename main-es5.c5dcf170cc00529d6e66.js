!function(){function t(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var a,u=t[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(c){o=!0,i=c}finally{try{r||null==u.return||u.return()}finally{if(o)throw i}}return n}(t,e)||d(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=d(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,i=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw i}}}}function n(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}function o(t){var e=c();return function(){var n,r=l(t);if(e){var o=l(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return i(this,n)}}function i(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function a(t){var e="function"==typeof Map?new Map:void 0;return(a=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return u(t,arguments,l(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),s(r,t)})(t)}function u(t,e,n){return(u=c()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var o=new(Function.bind.apply(t,r));return n&&s(o,n.prototype),o}).apply(null,arguments)}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function f(t){return function(t){if(Array.isArray(t))return p(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||d(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(t,e){if(t){if("string"==typeof t)return p(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(t,e):void 0}}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function v(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function b(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function h(t,e,n){return e&&b(t.prototype,e),n&&b(t,n),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{0:function(t,e,n){t.exports=n("2v48")},"0PiK":function(t,e,n){"use strict";n.d(e,"a",(function(){return a})),n.d(e,"b",(function(){return u})),n.d(e,"c",(function(){return o})),n.d(e,"d",(function(){return r})),n.d(e,"e",(function(){return i}));var r="NGXS_DATA_STORAGE_EVENT_TYPE",o="NGXS_DATA_META",i="NGXS_META",a="NGXS_ARGUMENT_REGISTRY_META",u="NGXS_COMPUTED_OPTION"},"2v48":function(t,e,n){"use strict";n.r(e);var r,o,i,a,u=n("8Y7J"),c=n("s7LF"),s=n("cUpR"),l=n("omvX"),d=n("938j"),p=((r=function(){function t(e,n){v(this,t),this.accessor=e,this.injector=n}return h(t,null,[{key:"forRoot",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return{ngModule:t,providers:[d.a,d.b,d.c].concat(f(e))}}}]),t}()).\u0275mod=Object(u.Ob)({type:r}),r.\u0275inj=Object(u.Nb)({factory:function(t){return new(t||r)(Object(u.ac)(d.a,2),Object(u.ac)(d.b,2))}}),r),b=n("j+Mg"),y=n("ZArt"),g=n("e1JD"),m=n("iInd"),x=((o=function t(){v(this,t)}).\u0275mod=u.Ob({type:o}),o.\u0275inj=u.Nb({factory:function(t){return new(t||o)},imports:[[m.b.forRoot([{path:"",redirectTo:"count",pathMatch:"full"},{path:"count",loadChildren:function(){return Promise.all([n.e(0),n.e(11)]).then(n.bind(null,"iBbY")).then((function(t){return t.CountModule}))}},{path:"todo",loadChildren:function(){return Promise.all([n.e(0),n.e(2),n.e(13)]).then(n.bind(null,"BX/J")).then((function(t){return t.TodoModule}))}},{path:"person",loadChildren:function(){return Promise.all([n.e(0),n.e(3),n.e(12)]).then(n.bind(null,"rAEy")).then((function(t){return t.PersonModule}))}},{path:"amount",loadChildren:function(){return Promise.all([n.e(0),n.e(9)]).then(n.bind(null,"h86J")).then((function(t){return t.AmountModule}))}},{path:"article",loadChildren:function(){return Promise.all([n.e(0),n.e(2),n.e(3),n.e(10)]).then(n.bind(null,"BVaH")).then((function(t){return t.ArticleModule}))}}],{useHash:!0})],m.b]}),o),O=n("SVse"),S=function(){return["count"]},k=function(){return["todo"]},w=function(){return["person"]},j=function(){return["amount"]},M=function(){return["article"]},E=((a=function(){function t(e){v(this,t),this.store=e,this.snapshot=this.store.select((function(t){return t}))}return h(t,[{key:"ngOnInit",value:function(){console.log("[isDevMode]",Object(u.bb)())}}]),t}()).\u0275fac=function(t){return new(t||a)(u.Qb(g.g))},a.\u0275cmp=u.Kb({type:a,selectors:[["app-root"]],decls:72,vars:15,consts:[[1,"panel"],["src","https://habrastorage.org/webt/k7/ih/pc/k7ihpcg6w-jz-rzksmiyuip5_so.png",1,"logo"],[1,"panel-content"],[1,"menu"],[1,"menu-top"],["href","https://github.com/ngxs-labs/data/tree/master/docs","target","_blank",1,"link"],["href","https://stackblitz.io/github/ngxs-labs/data","target","_blank",1,"link"],[1,"ng-icon"],["src","https://cdn.worldvectorlogo.com/logos/angular-icon-1.svg",1,"img"],[1,"link",3,"routerLink"],[1,"container"],[1,"content"]],template:function(t,e){1&t&&(u.Wb(0,"div",0),u.xc(1,"\n    "),u.Rb(2,"img",1),u.xc(3,"\n\n    "),u.Wb(4,"div",2),u.xc(5,"\n        "),u.Wb(6,"h2"),u.xc(7,"Store:"),u.Vb(),u.xc(8,"\n        "),u.Wb(9,"pre"),u.xc(10),u.gc(11,"json"),u.gc(12,"async"),u.Vb(),u.xc(13,"\n    "),u.Vb(),u.xc(14,"\n"),u.Vb(),u.xc(15,"\n\n"),u.Wb(16,"div",3),u.xc(17,"\n    "),u.Wb(18,"div",4),u.xc(19,"\n        "),u.Wb(20,"span"),u.xc(21,"\n            \ud83e\uddfe\n            "),u.Wb(22,"a",5),u.xc(23,"\n                Official documentation\n            "),u.Vb(),u.xc(24,"\n        "),u.Vb(),u.xc(25,"\n        "),u.Wb(26,"span"),u.xc(27,"\n            \ud83d\ude80 "),u.Wb(28,"a",6),u.xc(29,"Stackblitz"),u.Vb(),u.xc(30,"\n        "),u.Vb(),u.xc(31,"\n        "),u.Wb(32,"span",7),u.xc(33,"\n            "),u.Rb(34,"img",8),u.xc(35,"\n            Angular 8+, NGXS 3.6.2+\n        "),u.Vb(),u.xc(36,"\n    "),u.Vb(),u.xc(37,"\n\n    "),u.Wb(38,"span"),u.xc(39,"\ud83c\udfc0 "),u.Wb(40,"a",9),u.xc(41,"CountState"),u.Vb(),u.Vb(),u.xc(42,"\n    "),u.Wb(43,"span"),u.xc(44,"\ud83e\udded "),u.Wb(45,"a",9),u.xc(46,"TodoState"),u.Vb(),u.Vb(),u.xc(47,"\n    "),u.Wb(48,"span"),u.xc(49,"\ud83d\ude0b "),u.Wb(50,"a",9),u.xc(51,"PersonState"),u.Vb(),u.Vb(),u.xc(52,"\n    "),u.Wb(53,"span"),u.xc(54,"\ud83d\udcb0 "),u.Wb(55,"a",9),u.xc(56,"AmountState"),u.Vb(),u.Vb(),u.xc(57,"\n    "),u.Wb(58,"span"),u.xc(59,"\ud83d\udccb "),u.Wb(60,"a",9),u.xc(61,"ArticleEntitiesState"),u.Vb(),u.Vb(),u.xc(62,"\n"),u.Vb(),u.xc(63,"\n\n"),u.Rb(64,"br"),u.xc(65,"\n\n"),u.Wb(66,"div",10),u.xc(67,"\n    "),u.Wb(68,"div",11),u.Rb(69,"router-outlet"),u.Vb(),u.xc(70,"\n"),u.Vb(),u.xc(71,"\n")),2&t&&(u.Gb(10),u.yc(u.hc(11,6,u.hc(12,8,e.snapshot))),u.Gb(30),u.kc("routerLink",u.lc(10,S)),u.Gb(5),u.kc("routerLink",u.lc(11,k)),u.Gb(5),u.kc("routerLink",u.lc(12,w)),u.Gb(5),u.kc("routerLink",u.lc(13,j)),u.Gb(5),u.kc("routerLink",u.lc(14,M)))},directives:[m.a,m.c],pipes:[O.f,O.b],encapsulation:2,changeDetection:0}),a),I=((i=function t(){v(this,t)}).\u0275mod=u.Ob({type:i,bootstrap:[E]}),i.\u0275inj=u.Nb({factory:function(t){return new(t||i)},providers:[],imports:[[s.a,c.e,x,l.b,c.k,g.c.forRoot([],{developmentMode:!1,executionStrategy:g.d}),y.a.forRoot(),p.forRoot([b.b,b.a])]]}),i);Object(u.X)(),s.c().bootstrapModule(I).catch((function(t){return console.error(t)}))},"938j":function(t,e,i){"use strict";i.d(e,"a",(function(){return E})),i.d(e,"b",(function(){return M})),i.d(e,"c",(function(){return j})),i.d(e,"d",(function(){return S})),i.d(e,"e",(function(){return O})),i.d(e,"f",(function(){return _})),i.d(e,"g",(function(){return D})),i.d(e,"h",(function(){return I})),i.d(e,"i",(function(){return A})),i.d(e,"j",(function(){return N})),i.d(e,"k",(function(){return J})),i.d(e,"l",(function(){return G})),i.d(e,"m",(function(){return W})),i.d(e,"n",(function(){return L})),i.d(e,"o",(function(){return k})),i.d(e,"p",(function(){return R})),i.d(e,"q",(function(){return w})),i.d(e,"r",(function(){return X})),i.d(e,"s",(function(){return F})),i.d(e,"t",(function(){return T})),i.d(e,"u",(function(){return V}));var u=i("UA48"),c=i("0PiK"),s=i("8Y7J"),l=i("e1JD"),f=i("Mrqg"),d=i("2Vo4"),p=i("cp0P"),b=i("7+OI"),y=i("lJxs"),g=i("UXun");function m(t){return t.NGXS_OPTIONS_META||{name:""}}var x=function(t){r(n,t);var e=o(n);function n(t){return v(this,n),e.call(this,"Child states can only be added to an object. Cannot convert ".concat(t&&t.constructor?t.constructor.name:t," to PlainObject"))}return n}(a(Error));function O(t){var e,n=m(t),r=null!==(e=n.children)&&void 0!==e?e:[],o=void 0===n.defaults?{}:n.defaults,i=Object(u.a)(o);if(r.length){if(Object(u.d)(i))return function(t,e){return e.reduce((function(t,e){var n=m(e);if(!n.name)throw new Error("State name not provided in class");return t[n.name.toString()]=O(e),t}),null!=t?t:{})}(i,r);throw new x(i)}return i}function S(t){for(var e=t.statePath,n=t.argumentsNames,r=t.methodName,o=t.argumentRegistry,i="",a=0;a<n.length;a++)(null==o?void 0:o.getArgumentNameByIndex(a))?i+=null==o?void 0:o.getArgumentNameByIndex(a):(null==o?void 0:o.getPayloadTypeByIndex(a))?i+=null==o?void 0:o.getPayloadTypeByIndex(a):i+="$arg"+a,a!==n.length-1&&(i+=", ");return"@".concat(e.replace(/\./g,"/"),".").concat(r,"(").concat(i,")")}function k(t){if(!t.hasOwnProperty(c.e)){var e={name:null,actions:{},defaults:{},path:null,makeRootSelector:function(t){return t.getStateGetter(e.name)},children:[]};Object.defineProperty(t,c.e,{value:e})}return function(t){return t[c.e]}(t)}function w(t){return t[c.c]}var j=function(){var t=function(){function t(e){var n=this;v(this,t),this.sequence$=new d.a(0),this.subscription=null,e&&(this.subscription=e.subscribe((function(){return n.updateSequence()})))}return h(t,[{key:"ngOnDestroy",value:function(){var t;this.sequence$.next(0),null===(t=this.subscription)||void 0===t||t.unsubscribe()}},{key:"updateSequence",value:function(){this.sequence$.next(this.sequenceValue+1)}},{key:"sequenceValue",get:function(){return this.sequence$.getValue()}}]),t}();return t.\u0275fac=function(e){return new(e||t)(Object(s.ac)(l.g,8))},t.\u0275prov=Object(s.Mb)({token:t,factory:t.\u0275fac}),t}(),M=function(){var t=function t(e,n,r){v(this,t),t.store=e.get(l.g),t.ngZone=e.get(s.D),t.factory=n,t.context=r,t.computed=e.get(j)};return t.store=null,t.computed=null,t.context=null,t.factory=null,t.ngZone=null,t.\u0275fac=function(e){return new(e||t)(Object(s.ac)(s.u),Object(s.ac)(f.d),Object(s.ac)(f.c))},t.\u0275prov=Object(s.Mb)({token:t,factory:t.\u0275fac}),t}(),E=function(){var t=function(){function t(){v(this,t),t.statesCachedMeta.clear()}return h(t,null,[{key:"createStateContext",value:function(t){return M.context.createStateContext(t)}},{key:"ensureMappedState",value:function(e){if(!M.factory||!e)throw new Error("Metadata not created \n Maybe you forgot to import the NgxsDataPluginModule\n Also, you cannot use this.ctx.* until the application is fully rendered \n (use by default ngxsOnInit(ctx: StateContext), or ngxsAfterBootstrap(ctx: StateContext) !!!");return(e.name?t.statesCachedMeta.get(e.name):null)||t.ensureMeta(e)}},{key:"getRepositoryByInstance",value:function(e){var n=w(t.getStateClassByInstance(e))||null;if(!n)throw new Error("You forgot add decorator @StateRepository or initialize state!\nExample: NgxsModule.forRoot([ .. ]), or NgxsModule.forFeature([ .. ])");return n}},{key:"getStateClassByInstance",value:function(t){return(t||{}).constructor}},{key:"clearMetaByInstance",value:function(e){var n=t.getRepositoryByInstance(e);n.stateMeta.actions={},n.operations={}}},{key:"createPayload",value:function(t,e){for(var n={},r=Array.from(t),o=0;o<r.length;o++){var i=null==e?void 0:e.getPayloadTypeByIndex(o);i&&(n[i]=r[o])}return Object.keys(n).length>0?n:null}},{key:"createAction",value:function(e,n,r){var o,i=t.createPayload(n,r);return new(o=e.type,function(){function t(e){var n=this;v(this,t),e&&Object.keys(e).forEach((function(t){n[t]=e[t]}))}return h(t,null,[{key:"type",get:function(){return o}}]),t}())(i)}},{key:"ensureMeta",value:function(e){var n,r=e.name?null===(n=M.factory.states)||void 0===n?void 0:n.find((function(t){return t.name===e.name})):null;return r&&e.name&&t.statesCachedMeta.set(e.name,r),r}}]),t}();return t.statesCachedMeta=new Map,t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=Object(s.Mb)({token:t,factory:t.\u0275fac}),t}();function I(t){return{enumerable:!0,configurable:!0,get:function(){var e=w(t),n=E.ensureMappedState(e.stateMeta);return E.createStateContext(n)}}}function A(t,e){(function(t){var e,n=null!==(e=w(t))&&void 0!==e?e:null;return(!n||(null==n?void 0:n.stateClass)!==t)&&function(t){Object.defineProperty(t,c.c,{writable:!0,configurable:!0,enumerable:!0,value:{stateMeta:null,operations:{},stateClass:t}})}(t),w(t)}(t)).stateMeta=e}function N(t){var e=w(t),r=e.stateMeta&&e.stateMeta.name||null;if(r){var o,i="__".concat(r,"__selector");Object.defineProperties(t.prototype,(n(o={},i,{writable:!0,enumerable:!1,configurable:!0}),n(o,"state$",{enumerable:!0,configurable:!0,get:function(){if(this[i])return this[i];if(!M.store)throw new Error("Metadata not created \n Maybe you forgot to import the NgxsDataPluginModule\n Also, you cannot use this.ctx.* until the application is fully rendered \n (use by default ngxsOnInit(ctx: StateContext), or ngxsAfterBootstrap(ctx: StateContext) !!!");return this[i]=M.store.select(t).pipe(Object(y.a)((function(t){return Object(s.bb)()?Object(u.b)(t):t})),Object(g.a)({refCount:!0,bufferSize:1})),this[i]}}),o))}}function T(t,e){if(t.hasOwnProperty("prototype"))throw new Error("Cannot support static methods with @DataAction()");if(void 0===e)throw new Error("@DataAction() can only decorate a method implementation")}function _(){if(!M.ngZone)throw new Error("Metadata not created \n Maybe you forgot to import the NgxsDataPluginModule\n Also, you cannot use this.ctx.* until the application is fully rendered \n (use by default ngxsOnInit(ctx: StateContext), or ngxsAfterBootstrap(ctx: StateContext) !!!")}function D(t,e){return Object(p.a)([t,e]).pipe(Object(y.a)((function(t){return t.pop()})))}var P=function(t){r(n,t);var e=o(n);function n(t,r){return v(this,n),e.call(this,"An argument with the name '".concat(t,"' already exists in the method '").concat(r,"'"))}return n}(a(Error)),C=function(){function t(){v(this,t),this.payloadMap=new Map,this.argumentMap=new Map}return h(t,[{key:"getPayloadTypeByIndex",value:function(t){var e;return null!==(e=this.payloadMap.get(t))&&void 0!==e?e:null}},{key:"getArgumentNameByIndex",value:function(t){var e;return null!==(e=this.argumentMap.get(t))&&void 0!==e?e:null}},{key:"createPayloadType",value:function(t,e,n){this.checkDuplicateName(t,e),this.payloadMap.set(n,t),this.payloadMap.set(t,t)}},{key:"createArgumentName",value:function(t,e,n){this.checkDuplicateName(t,e),this.argumentMap.set(n,t),this.argumentMap.set(t,t)}},{key:"checkDuplicateName",value:function(t,e){if(this.argumentMap.has(t)||this.payloadMap.has(t))throw new P(t,e)}}]),t}();function R(t){return t[c.a]}function W(t,e){var r=t[e];return R(r)||Object.defineProperties(r,n({},c.a,{enumerable:!0,configurable:!0,value:new C})),R(r)}function V(t,e){if(!Object(u.c)(t,null==e?void 0:e.toString()))throw new Error("The method must be a getter for the computed decorator to work properly.\nExample: \n@Computed() get ".concat(e.toString(),"() { \n\t .. \n}"))}function G(t){if(!t)throw new Error("You forgot add decorator @StateRepository or initialize state!\nExample: NgxsModule.forRoot([ .. ]), or NgxsModule.forFeature([ .. ])");return Object.assign(Object.assign({},t),{getState:function(){return Object(s.bb)()?Object(u.b)(t.getState()):t.getState()},setState:function(e){t.setState(e)},patchState:function(e){t.patchState(e)}})}function B(){return"__".concat(c.b,"__")}function z(t){var e;return null!==(e=t[B()])&&void 0!==e?e:null}function J(t){return z(t)||Object.defineProperties(t,n({},B(),{enumerable:!0,configurable:!0,value:new WeakMap})),z(t)}function L(t){return Object(s.bb)()?Object(u.b)(t):t}function X(){var t,e;return null!==(e=null===(t=null==M?void 0:M.computed)||void 0===t?void 0:t.sequenceValue)&&void 0!==e?e:0}function F(t){var e=!1;return Object(b.a)(t)&&(e=!0),e}},"BS/u":function(t,e){function n(t){return Promise.resolve().then((function(){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}))}n.keys=function(){return[]},n.resolve=n,t.exports=n,n.id="BS/u"},"j+Mg":function(n,i,u){"use strict";u.d(i,"a",(function(){return S})),u.d(i,"b",(function(){return B})),u.d(i,"c",(function(){return L})),u.d(i,"d",(function(){return J}));var c=u("8Y7J"),s=u("e1JD"),l=u("WbJO"),f=u("SVse"),d=u("0PiK"),p=u("l5mm"),b=u("xgIS"),y=u("vkgz"),g=u("938j"),m=u("UA48"),x=new c.t("NGXS_DATA_STORAGE_CONTAINER_TOKEN"),O=function(){function t(){v(this,t),this.providers=new Set,this.keys=new Map}return h(t,[{key:"getProvidedKeys",value:function(){return Array.from(this.keys.keys())}}]),t}(),S={provide:x,useFactory:function(){return new O}},k=new c.t("NGXS_DATA_STORAGE_DECODE_TYPE_TOKEN");function w(t){return-1!==t.ttl&&!isNaN(t.ttl)&&t.ttl>0}function j(t){return Date.now()>=t.getTime()}function M(t){return"".concat(t.prefixKey).concat(t.path)}function E(t,e){var n,r,o,i=e.provider,a={key:t,expiry:e.expiry.toISOString(),timestamp:new Date(Date.now()).toISOString()},u=i.stateInstance;null===(n=null==u?void 0:u.expired$)||void 0===n||n.next(a),(null==u?void 0:u.ngxsDataAfterExpired)&&(g.b.ngZone?null===(r=g.b.ngZone)||void 0===r||r.run((function(){var t;return null===(t=null==u?void 0:u.ngxsDataAfterExpired)||void 0===t?void 0:t.call(u,a,i)})):null===(o=null==u?void 0:u.ngxsDataAfterExpired)||void 0===o||o.call(u,a,i))}var I=function(t){r(n,t);var e=o(n);function n(t){return v(this,n),e.call(this,"".concat(t,". \nIncorrect structure for deserialization!!! Your structure should be like this: \n").concat(JSON.stringify({lastChanged:"2020-01-01T12:00:00.000Z",data:"{}",version:1},null,4)))}return n}(a(Error));function A(t){try{return JSON.parse(t)}catch(e){throw new I(e.message)}}function N(t){var e,n,r=t.provider,o=t.map;null===(e=o.get(r))||void 0===e||e.subscription.unsubscribe();var i=function(){var e=new Date(Date.now()).toISOString(),n=Object(p.a)(r.ttlDelay).subscribe((function(){return function(t,e,n){var r=e.provider,o=e.expiry,i=e.map,a=e.engine,u=M(r),c=a.getItem(u);if(c){if(j(o)){var s=new Date(Date.now()).toISOString();!function(t,e,n){var r=n.provider,o=n.engine;switch(r.ttlExpiredStrategy){case 0:o.removeItem(t);break;case 1:var i=A(e);i.data=null,o.setItem(t,JSON.stringify(i))}}(u,c,e),E(u,e),n.unsubscribe(),i.set(r,{subscription:n,startListen:t,endListen:s})}}else n.unsubscribe()}(e,t,n)}));o.set(r,{subscription:n,startListen:e,endListen:null})};g.b.ngZone?null===(n=g.b.ngZone)||void 0===n||n.runOutsideAngular((function(){return i()})):i()}var T=function(t){r(n,t);var e=o(n);function n(){return v(this,n),e.call(this,"missing key 'data' or it's value not serializable.")}return n}(a(Error)),_=function(t){r(n,t);var e=o(n);function n(t){return v(this,n),e.call(this,"lastChanged key not found in object ".concat(t,"."))}return n}(a(Error)),D=function(t){r(n,t);var e=o(n);function n(t){return v(this,n),e.call(this,"It's not possible to determine version (".concat(t,"), since it must be a integer type and must equal or more than 1."))}return n}(a(Error));function P(t,e){var n=Object(l.d)(t)?t:null;return"base64"===e.decode?btoa(JSON.stringify(n)):n}var C=function(t){r(n,t);var e=o(n);function n(t){return v(this,n),e.call(this,"Not found storage engine from `existingEngine` or not found instance after injecting by `useClass`. \nMetadata { key: '".concat(t,"' }"))}return n}(a(Error)),R=function(t){r(n,t);var e=o(n);function n(){return v(this,n),e.call(this,"StorageEngine instance should be implemented by DataStorageEngine interface")}return n}(a(Error));function W(t,e){var n=t.existingEngine||e.get(t.useClass,null);if(!n)throw new C(M(t));if(!("getItem"in n))throw new R;return n}function V(t,e){console.warn("Error occurred while serializing value from metadata { key: '".concat(t,"' }. \nError serialize: ").concat(e))}var G=function(){var n=function(){function n(t,e){v(this,n),this._platformId=t,n.injector=e,this.listenWindowEvents()}return h(n,[{key:"handle",value:function(t,e,n){var r=this;if(this.skipStorageInterceptions)return n(t,e);var o=function(t){var e=Object(s.i)(t);return e(s.a)||e(s.h)}(e);return n(t=this.pullStateFromStorage(t,{action:e,init:o}),e).pipe(Object(y.a)((function(n){return r.pushStateToStorage(t,n,{action:e,init:o})})))}},{key:"serialize",value:function(t,e){var r={version:e.version,lastChanged:(new Date).toISOString(),data:P(t,e)};if(w(e)){var o=W(e,n.injector),i=new Date(Date.now()+parseInt(e.ttl));N({provider:e,expiry:i,map:this.ttlListeners,engine:o}),r.expiry=i.toISOString()}return JSON.stringify(r)}},{key:"deserialize",value:function(t,e,n){return function(t,e,n){if(Object(m.d)(t)){if(function(t){return!("lastChanged"in t)||!t.lastChanged}(t))throw new _(e);if(function(t){var e=parseFloat(t.version);return isNaN(e)||e<1||parseInt(t.version)!==e}(t))throw new D(t.version);if(function(t){return!("data"in t)}(t))throw new T;return"base64"===n.decode?JSON.parse(atob(t.data)):t.data}throw new I('"'.concat(e,'" not an object'))}(t,e,n)}},{key:"destroyOldTasks",value:function(){var t;null===(t=n.eventsSubscriptions)||void 0===t||t.unsubscribe(),n.ttlListeners=new WeakMap}},{key:"pushStateToStorage",value:function(r,o,i){var a,u=e(this.entries);try{for(u.s();!(a=u.n()).done;){var c=t(a.value,1)[0],l=Object(s.k)(r,c.path),f=Object(s.k)(o,c.path),d=c.fireInit&&i.init;if(l!==f||d){var p=W(c,n.injector),v=M(c);try{var b=this.serialize(f,c);p.setItem(v,b),this.keys.set(v)}catch(h){V(v,h.message)}}}}catch(y){u.e(y)}finally{u.f()}}},{key:"pullStateFromStorage",value:function(n,r){var o=r.action,i=r.init;if(this.canBeSyncStoreWithStorage(o,i)){var a,u=e(this.entries);try{for(u.s();!(a=u.n()).done;){var c=t(a.value,1)[0];n=this.deserializeByProvider(n,o,c)}}catch(s){u.e(s)}finally{u.f()}}return n}},{key:"canBeSyncStoreWithStorage",value:function(t,e){return this.size>0&&(e||t.type===d.d)}},{key:"deserializeByProvider",value:function(t,e,r){var o=M(r),i=W(r,n.injector),a=i.getItem(o);return Object(l.d)(a)&&(t=this.deserializeHandler(t,{key:o,engine:i,provider:r,value:a,action:e})),t}},{key:"deserializeHandler",value:function(t,e){var r=e.key,o=e.provider,i=e.value;try{var a=A(i),u=this.deserialize(a,i,o),c=function(t){var e=t.data,n=t.provider,r=Object(l.d)(e)||n.nullable,o={canBeOverrideFromStorage:r,versionMismatch:!1,expired:!1,expiry:null};return o=function(t,e,n){var r=n.provider;if(t&&n.meta.version!==r.version){var o=r.stateInstance,i=!(r.skipMigrate||!(null==o?void 0:o.ngxsDataStorageMigrate)&&!r.migrate);e=Object.assign(Object.assign({},e),i?{versionMismatch:!0}:{canBeOverrideFromStorage:!1,versionMismatch:!0})}return e}(r,o=function(t,e,n){var r=n.meta;if(t&&w(n.provider)){var o=new Date(r.expiry);!isNaN(o.getTime())&&(e=j(o)?{canBeOverrideFromStorage:!1,expired:!0,expiry:o,versionMismatch:!1}:{canBeOverrideFromStorage:t,expired:!1,expiry:o,versionMismatch:!1})}return e}(r,o,t),t)}({provider:o,meta:a,data:u});if(c.canBeOverrideFromStorage){var f=function(t){var e,n=t.states,r=t.provider,o=t.data,i=t.info;if(!r.rehydrate)return{states:n,rehydrateIn:!1};var a=Object(s.k)(n,r.path);if(i.versionMismatch){var u=r.stateInstance,c=r.migrate||(null===(e=u.ngxsDataStorageMigrate)||void 0===e?void 0:e.bind(r.stateInstance)),l=null==c?void 0:c(a,o);return{states:n=Object(s.l)(n,r.path,l),rehydrateIn:!0}}return JSON.stringify(a)!==JSON.stringify(o)?{states:n=Object(s.l)(n,r.path,o),rehydrateIn:!0}:{states:n,rehydrateIn:!1}}({states:t,provider:o,data:u,info:c});this.keys.set(r),t=f.states,n.checkIsStorageEvent(e,f,u),n.checkExpiredInit({info:c,rehydrateInfo:f,options:e,map:this.ttlListeners})}else this.removeKeyWhenPullInvalid(c,e)}catch(d){!function(t,e,n){console.warn("Error occurred while deserializing value from metadata { key: '".concat(t,"', value: '").concat(e,"' }. \nError deserialize: ").concat(n))}(r,i,d.message)}return t}},{key:"removeKeyWhenPullInvalid",value:function(t,e){var n=e.key,r=e.engine,o=e.provider;t.expired&&E(n,{provider:o,engine:r,map:this.ttlListeners,expiry:t.expiry}),r.removeItem(n),this.keys.delete(n)}},{key:"listenWindowEvents",value:function(){var t=this;Object(f.r)(this._platformId)||(this.destroyOldTasks(),n.eventsSubscriptions=Object(b.a)(window,"storage").subscribe((function(e){e.key&&t.keys.has(e.key)&&t.store.dispatch({type:d.d})})))}},{key:"store",get:function(){return n.injector.get(s.g,null)}},{key:"size",get:function(){return this.providers.size}},{key:"ttlListeners",get:function(){return n.ttlListeners}},{key:"container",get:function(){return n.injector.get(x)}},{key:"providers",get:function(){return this.container.providers}},{key:"keys",get:function(){return this.container.keys}},{key:"entries",get:function(){return this.providers.entries()}},{key:"skipStorageInterceptions",get:function(){return 0===this.size||Object(f.r)(this._platformId)}}],[{key:"checkIsStorageEvent",value:function(t,e,n){var r,o=t.action,i=t.provider,a=t.key,u=t.value;if(e.rehydrateIn&&function(t){return t.type===d.d}(o)){var c=i.stateInstance;(null==c?void 0:c.ngxsDataAfterStorageEvent)&&(null===(r=null==c?void 0:c.ngxsDataAfterStorageEvent)||void 0===r||r.call(c,{key:a,value:u,data:n,provider:i}))}}},{key:"checkExpiredInit",value:function(t){var e=t.info,n=t.rehydrateInfo,r=t.options,o=t.map,i=r.provider,a=r.engine;n.rehydrateIn&&e.expiry&&N({provider:i,expiry:e.expiry,map:o,engine:a})}}]),n}();return n.injector=null,n.eventsSubscriptions=null,n.ttlListeners=new WeakMap,n.\u0275fac=function(t){return new(t||n)(Object(c.ac)(c.F),Object(c.ac)(c.u,2))},n.\u0275prov=Object(c.Mb)({token:n,factory:n.\u0275fac}),n}(),B={provide:s.b,useClass:G,multi:!0},z=new c.t("NGXS_DATA_STORAGE_PREFIX_TOKEN");function J(t){var e;try{var n=null===(e=G.injector)||void 0===e?void 0:e.get(x);t.forEach((function(t){null==n||n.providers.add(t)}))}catch(r){throw new Error("You forgot provide NGXS_DATA_STORAGE_CONTAINER or NGXS_DATA_STORAGE_EXTENSION!!! Example: \n\n@NgModule({\n imports: [ \n   NgxsDataPluginModule.forRoot([NGXS_DATA_STORAGE_PLUGIN]) \n ]\n})\nexport class AppModule {} \n\n")}}function L(t,e,n){var r,o,i,a,u=null!==(o=null===(r=G.injector)||void 0===r?void 0:r.get(z,"@ngxs.store."))&&void 0!==o?o:"@ngxs.store.",c=null!==(a=null===(i=G.injector)||void 0===i?void 0:i.get(k,"none"))&&void 0!==a?a:"none";return n?(Array.isArray(n)?n:[n]).map((function(n){return function(t){var e=t.option,n=t.decodeType,r=t.prefix,o=t.stateInstance;return function(t,e){return"path"in e||(e=Object.assign(Object.assign({},e),{get path(){return t.stateMeta&&t.stateMeta.path}})),e}(t.meta,Object.assign(Object.assign({},e),{ttl:Object(l.d)(e.ttl)?e.ttl:-1,version:Object(l.d)(e.version)?e.version:1,decode:Object(l.d)(e.decode)?e.decode:n,prefixKey:Object(l.d)(e.prefixKey)?e.prefixKey:r,nullable:!!Object(l.d)(e.nullable)&&e.nullable,fireInit:!Object(l.d)(e.fireInit)||e.fireInit,rehydrate:!Object(l.d)(e.rehydrate)||e.rehydrate,ttlDelay:Object(l.d)(e.ttlDelay)?e.ttlDelay:6e4,ttlExpiredStrategy:Object(l.d)(e.ttlExpiredStrategy)?e.ttlExpiredStrategy:0,stateInstance:Object(l.d)(e.stateInstance)?e.stateInstance:o,skipMigrate:!!Object(l.d)(e.skipMigrate)&&e.skipMigrate}))}({option:n,prefix:u,decodeType:c,meta:t,stateInstance:e})})):function(t){var e=t.meta;return[{get path(){return e.stateMeta&&e.stateMeta.path},existingEngine:localStorage,ttl:-1,version:1,decode:t.decodeType,prefixKey:t.prefix,nullable:!1,fireInit:!0,rehydrate:!0,ttlDelay:6e4,ttlExpiredStrategy:0,stateInstance:t.stateInstance,skipMigrate:!1}]}({meta:t,prefix:u,decodeType:c,stateInstance:e})}}},[[0,1,8]]])}();